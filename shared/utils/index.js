"use strict";
/**
 * Shared utility functions
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createError = exports.RiftRewindError = exports.take = exports.sortBy = exports.groupBy = exports.hashPlayerId = exports.isValidRegion = exports.isValidSummonerName = exports.isValidPUUID = exports.isWithinDays = exports.getTimeAgo = exports.calculateTrend = exports.calculatePercentile = exports.calculateMedian = exports.calculateAverage = exports.calculateCSPerMin = exports.calculateWinRate = exports.calculateKDA = exports.formatNumber = exports.formatDuration = exports.formatPercentage = exports.formatKDA = void 0;
// ============================================================================
// Data Formatting
// ============================================================================
function formatKDA(kills, deaths, assists) {
    const kda = deaths === 0 ? kills + assists : (kills + assists) / deaths;
    return kda.toFixed(2);
}
exports.formatKDA = formatKDA;
function formatPercentage(value, decimals = 1) {
    return `${value.toFixed(decimals)}%`;
}
exports.formatPercentage = formatPercentage;
function formatDuration(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}
exports.formatDuration = formatDuration;
function formatNumber(value, decimals = 0) {
    return value.toFixed(decimals);
}
exports.formatNumber = formatNumber;
// ============================================================================
// Statistical Calculations
// ============================================================================
function calculateKDA(kills, deaths, assists) {
    return deaths === 0 ? kills + assists : (kills + assists) / deaths;
}
exports.calculateKDA = calculateKDA;
function calculateWinRate(wins, total) {
    return total === 0 ? 0 : (wins / total) * 100;
}
exports.calculateWinRate = calculateWinRate;
function calculateCSPerMin(cs, durationSeconds) {
    return (cs / durationSeconds) * 60;
}
exports.calculateCSPerMin = calculateCSPerMin;
function calculateAverage(values) {
    if (values.length === 0)
        return 0;
    const sum = values.reduce((acc, val) => acc + val, 0);
    return sum / values.length;
}
exports.calculateAverage = calculateAverage;
function calculateMedian(values) {
    if (values.length === 0)
        return 0;
    const sorted = [...values].sort((a, b) => a - b);
    const mid = Math.floor(sorted.length / 2);
    return sorted.length % 2 === 0
        ? (sorted[mid - 1] + sorted[mid]) / 2
        : sorted[mid];
}
exports.calculateMedian = calculateMedian;
function calculatePercentile(value, values) {
    const sorted = [...values].sort((a, b) => a - b);
    const index = sorted.findIndex((v) => v >= value);
    if (index === -1)
        return 100;
    return (index / sorted.length) * 100;
}
exports.calculatePercentile = calculatePercentile;
function calculateTrend(values) {
    if (values.length < 2) {
        return { slope: 0, correlation: 0, improvementPercentage: 0 };
    }
    const n = values.length;
    const xValues = Array.from({ length: n }, (_, i) => i);
    // Linear regression
    const xMean = calculateAverage(xValues);
    const yMean = calculateAverage(values);
    let numerator = 0;
    let xDenominator = 0;
    let yDenominator = 0;
    for (let i = 0; i < n; i++) {
        const xDiff = xValues[i] - xMean;
        const yDiff = values[i] - yMean;
        numerator += xDiff * yDiff;
        xDenominator += xDiff * xDiff;
        yDenominator += yDiff * yDiff;
    }
    const slope = xDenominator === 0 ? 0 : numerator / xDenominator;
    const correlation = Math.sqrt(xDenominator * yDenominator) === 0
        ? 0
        : numerator / Math.sqrt(xDenominator * yDenominator);
    const firstValue = values[0];
    const lastValue = values[n - 1];
    const improvementPercentage = firstValue === 0
        ? 0
        : ((lastValue - firstValue) / firstValue) * 100;
    return { slope, correlation, improvementPercentage };
}
exports.calculateTrend = calculateTrend;
// ============================================================================
// Date/Time Utilities
// ============================================================================
function getTimeAgo(timestamp) {
    const now = Date.now();
    const then = typeof timestamp === 'string' ? new Date(timestamp).getTime() : timestamp;
    const diffMs = now - then;
    const diffSec = Math.floor(diffMs / 1000);
    const diffMin = Math.floor(diffSec / 60);
    const diffHour = Math.floor(diffMin / 60);
    const diffDay = Math.floor(diffHour / 24);
    if (diffDay > 0)
        return `${diffDay}d ago`;
    if (diffHour > 0)
        return `${diffHour}h ago`;
    if (diffMin > 0)
        return `${diffMin}m ago`;
    return `${diffSec}s ago`;
}
exports.getTimeAgo = getTimeAgo;
function isWithinDays(timestamp, days) {
    const now = Date.now();
    const then = typeof timestamp === 'string' ? new Date(timestamp).getTime() : timestamp;
    const diffMs = now - then;
    const diffDays = diffMs / (1000 * 60 * 60 * 24);
    return diffDays <= days;
}
exports.isWithinDays = isWithinDays;
// ============================================================================
// Validation
// ============================================================================
function isValidPUUID(puuid) {
    // Riot PUUIDs are 78 characters, alphanumeric + dashes
    return /^[a-zA-Z0-9_-]{78}$/.test(puuid);
}
exports.isValidPUUID = isValidPUUID;
function isValidSummonerName(name) {
    // 3-16 characters, alphanumeric + spaces
    return /^[a-zA-Z0-9 ]{3,16}$/.test(name);
}
exports.isValidSummonerName = isValidSummonerName;
function isValidRegion(region) {
    const validRegions = ['NA1', 'EUW1', 'EUN1', 'KR', 'BR1', 'LA1', 'LA2', 'OC1', 'TR1', 'RU', 'JP1'];
    return validRegions.includes(region);
}
exports.isValidRegion = isValidRegion;
// ============================================================================
// Hashing & Privacy
// ============================================================================
async function hashPlayerId(puuid) {
    // Simple hash for demo (use crypto in production)
    let hash = 0;
    for (let i = 0; i < puuid.length; i++) {
        const char = puuid.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32-bit integer
    }
    return Math.abs(hash).toString(36);
}
exports.hashPlayerId = hashPlayerId;
// ============================================================================
// Array Utilities
// ============================================================================
function groupBy(array, key) {
    return array.reduce((acc, item) => {
        const group = key(item);
        if (!acc[group])
            acc[group] = [];
        acc[group].push(item);
        return acc;
    }, {});
}
exports.groupBy = groupBy;
function sortBy(array, key, desc = false) {
    return [...array].sort((a, b) => {
        const aVal = key(a);
        const bVal = key(b);
        return desc ? bVal - aVal : aVal - bVal;
    });
}
exports.sortBy = sortBy;
function take(array, count) {
    return array.slice(0, count);
}
exports.take = take;
// ============================================================================
// Error Handling
// ============================================================================
class RiftRewindError extends Error {
    constructor(code, message, details) {
        super(message);
        this.code = code;
        this.details = details;
        this.name = 'RiftRewindError';
    }
}
exports.RiftRewindError = RiftRewindError;
function createError(code, message, details) {
    return new RiftRewindError(code, message, details);
}
exports.createError = createError;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7OztBQUVILCtFQUErRTtBQUMvRSxrQkFBa0I7QUFDbEIsK0VBQStFO0FBRS9FLFNBQWdCLFNBQVMsQ0FBQyxLQUFhLEVBQUUsTUFBYyxFQUFFLE9BQWU7SUFDdEUsTUFBTSxHQUFHLEdBQUcsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEdBQUcsTUFBTSxDQUFDO0lBQ3hFLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4QixDQUFDO0FBSEQsOEJBR0M7QUFFRCxTQUFnQixnQkFBZ0IsQ0FBQyxLQUFhLEVBQUUsV0FBbUIsQ0FBQztJQUNsRSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDO0FBQ3ZDLENBQUM7QUFGRCw0Q0FFQztBQUVELFNBQWdCLGNBQWMsQ0FBQyxPQUFlO0lBQzVDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sSUFBSSxHQUFHLE9BQU8sR0FBRyxFQUFFLENBQUM7SUFDMUIsT0FBTyxHQUFHLElBQUksSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDO0FBQ3ZELENBQUM7QUFKRCx3Q0FJQztBQUVELFNBQWdCLFlBQVksQ0FBQyxLQUFhLEVBQUUsV0FBbUIsQ0FBQztJQUM5RCxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsQ0FBQztBQUZELG9DQUVDO0FBRUQsK0VBQStFO0FBQy9FLDJCQUEyQjtBQUMzQiwrRUFBK0U7QUFF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TkQsa0NBTUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNoYXJlZCB1dGlsaXR5IGZ1bmN0aW9uc1xuICovXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERhdGEgRm9ybWF0dGluZ1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0S0RBKGtpbGxzOiBudW1iZXIsIGRlYXRoczogbnVtYmVyLCBhc3Npc3RzOiBudW1iZXIpOiBzdHJpbmcge1xuICBjb25zdCBrZGEgPSBkZWF0aHMgPT09IDAgPyBraWxscyArIGFzc2lzdHMgOiAoa2lsbHMgKyBhc3Npc3RzKSAvIGRlYXRocztcbiAgcmV0dXJuIGtkYS50b0ZpeGVkKDIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0UGVyY2VudGFnZSh2YWx1ZTogbnVtYmVyLCBkZWNpbWFsczogbnVtYmVyID0gMSk6IHN0cmluZyB7XG4gIHJldHVybiBgJHt2YWx1ZS50b0ZpeGVkKGRlY2ltYWxzKX0lYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdER1cmF0aW9uKHNlY29uZHM6IG51bWJlcik6IHN0cmluZyB7XG4gIGNvbnN0IG1pbnMgPSBNYXRoLmZsb29yKHNlY29uZHMgLyA2MCk7XG4gIGNvbnN0IHNlY3MgPSBzZWNvbmRzICUgNjA7XG4gIHJldHVybiBgJHttaW5zfToke3NlY3MudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXROdW1iZXIodmFsdWU6IG51bWJlciwgZGVjaW1hbHM6IG51bWJlciA9IDApOiBzdHJpbmcge1xuICByZXR1cm4gdmFsdWUudG9GaXhlZChkZWNpbWFscyk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFN0YXRpc3RpY2FsIENhbGN1bGF0aW9uc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlS0RBKGtpbGxzOiBudW1iZXIsIGRlYXRoczogbnVtYmVyLCBhc3Npc3RzOiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gZGVhdGhzID09PSAwID8ga2lsbHMgKyBhc3Npc3RzIDogKGtpbGxzICsgYXNzaXN0cykgLyBkZWF0aHM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVXaW5SYXRlKHdpbnM6IG51bWJlciwgdG90YWw6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiB0b3RhbCA9PT0gMCA/IDAgOiAod2lucyAvIHRvdGFsKSAqIDEwMDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUNTUGVyTWluKGNzOiBudW1iZXIsIGR1cmF0aW9uU2Vjb25kczogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIChjcyAvIGR1cmF0aW9uU2Vjb25kcykgKiA2MDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUF2ZXJhZ2UodmFsdWVzOiBudW1iZXJbXSk6IG51bWJlciB7XG4gIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSByZXR1cm4gMDtcbiAgY29uc3Qgc3VtID0gdmFsdWVzLnJlZHVjZSgoYWNjLCB2YWwpID0+IGFjYyArIHZhbCwgMCk7XG4gIHJldHVybiBzdW0gLyB2YWx1ZXMubGVuZ3RoO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlTWVkaWFuKHZhbHVlczogbnVtYmVyW10pOiBudW1iZXIge1xuICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7XG4gIGNvbnN0IHNvcnRlZCA9IFsuLi52YWx1ZXNdLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcbiAgY29uc3QgbWlkID0gTWF0aC5mbG9vcihzb3J0ZWQubGVuZ3RoIC8gMik7XG4gIHJldHVybiBzb3J0ZWQubGVuZ3RoICUgMiA9PT0gMFxuICAgID8gKHNvcnRlZFttaWQgLSAxXSArIHNvcnRlZFttaWRdKSAvIDJcbiAgICA6IHNvcnRlZFttaWRdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlUGVyY2VudGlsZSh2YWx1ZTogbnVtYmVyLCB2YWx1ZXM6IG51bWJlcltdKTogbnVtYmVyIHtcbiAgY29uc3Qgc29ydGVkID0gWy4uLnZhbHVlc10uc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICBjb25zdCBpbmRleCA9IHNvcnRlZC5maW5kSW5kZXgoKHYpID0+IHYgPj0gdmFsdWUpO1xuICBpZiAoaW5kZXggPT09IC0xKSByZXR1cm4gMTAwO1xuICByZXR1cm4gKGluZGV4IC8gc29ydGVkLmxlbmd0aCkgKiAxMDA7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFRyZW5kIEFuYWx5c2lzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJlbmRSZXN1bHQge1xuICBzbG9wZTogbnVtYmVyOyAvLyBQb3NpdGl2ZSA9IGltcHJvdmluZywgbmVnYXRpdmUgPSBkZWNsaW5pbmdcbiAgY29ycmVsYXRpb246IG51bWJlcjsgLy8gLTEgdG8gMVxuICBpbXByb3ZlbWVudFBlcmNlbnRhZ2U6IG51bWJlcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVRyZW5kKHZhbHVlczogbnVtYmVyW10pOiBUcmVuZFJlc3VsdCB7XG4gIGlmICh2YWx1ZXMubGVuZ3RoIDwgMikge1xuICAgIHJldHVybiB7IHNsb3BlOiAwLCBjb3JyZWxhdGlvbjogMCwgaW1wcm92ZW1lbnRQZXJjZW50YWdlOiAwIH07XG4gIH1cblxuICBjb25zdCBuID0gdmFsdWVzLmxlbmd0aDtcbiAgY29uc3QgeFZhbHVlcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IG4gfSwgKF8sIGkpID0+IGkpO1xuICBcbiAgLy8gTGluZWFyIHJlZ3Jlc3Npb25cbiAgY29uc3QgeE1lYW4gPSBjYWxjdWxhdGVBdmVyYWdlKHhWYWx1ZXMpO1xuICBjb25zdCB5TWVhbiA9IGNhbGN1bGF0ZUF2ZXJhZ2UodmFsdWVzKTtcbiAgXG4gIGxldCBudW1lcmF0b3IgPSAwO1xuICBsZXQgeERlbm9taW5hdG9yID0gMDtcbiAgbGV0IHlEZW5vbWluYXRvciA9IDA7XG4gIFxuICBmb3IgKGxldCBpID0gMDsgaSA8IG47IGkrKykge1xuICAgIGNvbnN0IHhEaWZmID0geFZhbHVlc1tpXSAtIHhNZWFuO1xuICAgIGNvbnN0IHlEaWZmID0gdmFsdWVzW2ldIC0geU1lYW47XG4gICAgbnVtZXJhdG9yICs9IHhEaWZmICogeURpZmY7XG4gICAgeERlbm9taW5hdG9yICs9IHhEaWZmICogeERpZmY7XG4gICAgeURlbm9taW5hdG9yICs9IHlEaWZmICogeURpZmY7XG4gIH1cbiAgXG4gIGNvbnN0IHNsb3BlID0geERlbm9taW5hdG9yID09PSAwID8gMCA6IG51bWVyYXRvciAvIHhEZW5vbWluYXRvcjtcbiAgY29uc3QgY29ycmVsYXRpb24gPSBNYXRoLnNxcnQoeERlbm9taW5hdG9yICogeURlbm9taW5hdG9yKSA9PT0gMCBcbiAgICA/IDAgXG4gICAgOiBudW1lcmF0b3IgLyBNYXRoLnNxcnQoeERlbm9taW5hdG9yICogeURlbm9taW5hdG9yKTtcbiAgXG4gIGNvbnN0IGZpcnN0VmFsdWUgPSB2YWx1ZXNbMF07XG4gIGNvbnN0IGxhc3RWYWx1ZSA9IHZhbHVlc1tuIC0gMV07XG4gIGNvbnN0IGltcHJvdmVtZW50UGVyY2VudGFnZSA9IGZpcnN0VmFsdWUgPT09IDAgXG4gICAgPyAwIFxuICAgIDogKChsYXN0VmFsdWUgLSBmaXJzdFZhbHVlKSAvIGZpcnN0VmFsdWUpICogMTAwO1xuICBcbiAgcmV0dXJuIHsgc2xvcGUsIGNvcnJlbGF0aW9uLCBpbXByb3ZlbWVudFBlcmNlbnRhZ2UgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRGF0ZS9UaW1lIFV0aWxpdGllc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGltZUFnbyh0aW1lc3RhbXA6IHN0cmluZyB8IG51bWJlcik6IHN0cmluZyB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGNvbnN0IHRoZW4gPSB0eXBlb2YgdGltZXN0YW1wID09PSAnc3RyaW5nJyA/IG5ldyBEYXRlKHRpbWVzdGFtcCkuZ2V0VGltZSgpIDogdGltZXN0YW1wO1xuICBjb25zdCBkaWZmTXMgPSBub3cgLSB0aGVuO1xuICBjb25zdCBkaWZmU2VjID0gTWF0aC5mbG9vcihkaWZmTXMgLyAxMDAwKTtcbiAgY29uc3QgZGlmZk1pbiA9IE1hdGguZmxvb3IoZGlmZlNlYyAvIDYwKTtcbiAgY29uc3QgZGlmZkhvdXIgPSBNYXRoLmZsb29yKGRpZmZNaW4gLyA2MCk7XG4gIGNvbnN0IGRpZmZEYXkgPSBNYXRoLmZsb29yKGRpZmZIb3VyIC8gMjQpO1xuXG4gIGlmIChkaWZmRGF5ID4gMCkgcmV0dXJuIGAke2RpZmZEYXl9ZCBhZ29gO1xuICBpZiAoZGlmZkhvdXIgPiAwKSByZXR1cm4gYCR7ZGlmZkhvdXJ9aCBhZ29gO1xuICBpZiAoZGlmZk1pbiA+IDApIHJldHVybiBgJHtkaWZmTWlufW0gYWdvYDtcbiAgcmV0dXJuIGAke2RpZmZTZWN9cyBhZ29gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNXaXRoaW5EYXlzKHRpbWVzdGFtcDogc3RyaW5nIHwgbnVtYmVyLCBkYXlzOiBudW1iZXIpOiBib29sZWFuIHtcbiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgY29uc3QgdGhlbiA9IHR5cGVvZiB0aW1lc3RhbXAgPT09ICdzdHJpbmcnID8gbmV3IERhdGUodGltZXN0YW1wKS5nZXRUaW1lKCkgOiB0aW1lc3RhbXA7XG4gIGNvbnN0IGRpZmZNcyA9IG5vdyAtIHRoZW47XG4gIGNvbnN0IGRpZmZEYXlzID0gZGlmZk1zIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpO1xuICByZXR1cm4gZGlmZkRheXMgPD0gZGF5cztcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gVmFsaWRhdGlvblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZFBVVUlEKHB1dWlkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgLy8gUmlvdCBQVVVJRHMgYXJlIDc4IGNoYXJhY3RlcnMsIGFscGhhbnVtZXJpYyArIGRhc2hlc1xuICByZXR1cm4gL15bYS16QS1aMC05Xy1dezc4fSQvLnRlc3QocHV1aWQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNWYWxpZFN1bW1vbmVyTmFtZShuYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgLy8gMy0xNiBjaGFyYWN0ZXJzLCBhbHBoYW51bWVyaWMgKyBzcGFjZXNcbiAgcmV0dXJuIC9eW2EtekEtWjAtOSBdezMsMTZ9JC8udGVzdChuYW1lKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRSZWdpb24ocmVnaW9uOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgY29uc3QgdmFsaWRSZWdpb25zID0gWydOQTEnLCAnRVVXMScsICdFVU4xJywgJ0tSJywgJ0JSMScsICdMQTEnLCAnTEEyJywgJ09DMScsICdUUjEnLCAnUlUnLCAnSlAxJ107XG4gIHJldHVybiB2YWxpZFJlZ2lvbnMuaW5jbHVkZXMocmVnaW9uKTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gSGFzaGluZyAmIFByaXZhY3lcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc2hQbGF5ZXJJZChwdXVpZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgLy8gU2ltcGxlIGhhc2ggZm9yIGRlbW8gKHVzZSBjcnlwdG8gaW4gcHJvZHVjdGlvbilcbiAgbGV0IGhhc2ggPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHB1dWlkLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY2hhciA9IHB1dWlkLmNoYXJDb2RlQXQoaSk7XG4gICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgY2hhcjtcbiAgICBoYXNoID0gaGFzaCAmIGhhc2g7IC8vIENvbnZlcnQgdG8gMzItYml0IGludGVnZXJcbiAgfVxuICByZXR1cm4gTWF0aC5hYnMoaGFzaCkudG9TdHJpbmcoMzYpO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBcnJheSBVdGlsaXRpZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuZXhwb3J0IGZ1bmN0aW9uIGdyb3VwQnk8VCwgSyBleHRlbmRzIHN0cmluZyB8IG51bWJlcj4oXG4gIGFycmF5OiBUW10sXG4gIGtleTogKGl0ZW06IFQpID0+IEtcbik6IFJlY29yZDxLLCBUW10+IHtcbiAgcmV0dXJuIGFycmF5LnJlZHVjZSgoYWNjLCBpdGVtKSA9PiB7XG4gICAgY29uc3QgZ3JvdXAgPSBrZXkoaXRlbSk7XG4gICAgaWYgKCFhY2NbZ3JvdXBdKSBhY2NbZ3JvdXBdID0gW107XG4gICAgYWNjW2dyb3VwXS5wdXNoKGl0ZW0pO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9IGFzIFJlY29yZDxLLCBUW10+KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRCeTxUPihhcnJheTogVFtdLCBrZXk6IChpdGVtOiBUKSA9PiBudW1iZXIsIGRlc2MgPSBmYWxzZSk6IFRbXSB7XG4gIHJldHVybiBbLi4uYXJyYXldLnNvcnQoKGEsIGIpID0+IHtcbiAgICBjb25zdCBhVmFsID0ga2V5KGEpO1xuICAgIGNvbnN0IGJWYWwgPSBrZXkoYik7XG4gICAgcmV0dXJuIGRlc2MgPyBiVmFsIC0gYVZhbCA6IGFWYWwgLSBiVmFsO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRha2U8VD4oYXJyYXk6IFRbXSwgY291bnQ6IG51bWJlcik6IFRbXSB7XG4gIHJldHVybiBhcnJheS5zbGljZSgwLCBjb3VudCk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEVycm9yIEhhbmRsaW5nXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBjbGFzcyBSaWZ0UmV3aW5kRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBjb2RlOiBzdHJpbmcsXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHB1YmxpYyBkZXRhaWxzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gJ1JpZnRSZXdpbmRFcnJvcic7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVycm9yKFxuICBjb2RlOiBzdHJpbmcsXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgZGV0YWlscz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4pOiBSaWZ0UmV3aW5kRXJyb3Ige1xuICByZXR1cm4gbmV3IFJpZnRSZXdpbmRFcnJvcihjb2RlLCBtZXNzYWdlLCBkZXRhaWxzKTtcbn1cbiJdfQ==