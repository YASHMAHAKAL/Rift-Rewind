"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_s3_1 = require("@aws-sdk/client-s3");
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const lib_dynamodb_1 = require("@aws-sdk/lib-dynamodb");
const client_lambda_1 = require("@aws-sdk/client-lambda");
const s3Client = new client_s3_1.S3Client({});
const dynamoClient = lib_dynamodb_1.DynamoDBDocumentClient.from(new client_dynamodb_1.DynamoDBClient({}));
const lambdaClient = new client_lambda_1.LambdaClient({});
const MATCHES_TABLE = process.env.MATCHES_TABLE;
const RAW_BUCKET = process.env.RAW_BUCKET;
const PROCESSED_BUCKET = process.env.PROCESSED_BUCKET;
// Utility functions (inline to avoid import issues)
function calculateKDA(kills, deaths, assists) {
    return deaths === 0 ? kills + assists : (kills + assists) / deaths;
}
function calculateCSPerMin(cs, durationSeconds) {
    return (cs / durationSeconds) * 60;
}
/**
 * Processing Lambda - Compute stats and create match fragments
 */
const handler = async (event) => {
    console.log('Processing Lambda invoked', { event });
    const { puuid, matchId, region } = event;
    try {
        // 1. Read raw match data from S3
        const s3Key = `${region}/${puuid}/${matchId}.json`;
        const getCommand = new client_s3_1.GetObjectCommand({
            Bucket: RAW_BUCKET,
            Key: s3Key,
        });
        const response = await s3Client.send(getCommand);
        const matchData = JSON.parse(await response.Body.transformToString());
        console.log('Retrieved match data', { matchId });
        // 2. Find player's participant data
        const participant = matchData.info.participants.find((p) => p.puuid === puuid);
        if (!participant) {
            throw new Error(`Player ${puuid} not found in match ${matchId}`);
        }
        // 3. Compute statistics
        const stats = {
            matchId,
            puuid,
            championName: participant.championName,
            championId: participant.championId,
            role: participant.teamPosition || participant.individualPosition,
            kills: participant.kills,
            deaths: participant.deaths,
            assists: participant.assists,
            kda: calculateKDA(participant.kills, participant.deaths, participant.assists),
            totalCS: participant.totalMinionsKilled + participant.neutralMinionsKilled,
            csPerMin: calculateCSPerMin(participant.totalMinionsKilled + participant.neutralMinionsKilled, matchData.info.gameDuration),
            goldEarned: participant.goldEarned,
            damageDealt: participant.totalDamageDealtToChampions,
            damageTaken: participant.totalDamageTaken,
            visionScore: participant.visionScore,
            win: participant.win,
            gameDuration: matchData.info.gameDuration,
            gameMode: matchData.info.gameMode,
            queueId: matchData.info.queueId,
            gameCreation: matchData.info.gameCreation,
            timestamp: new Date(matchData.info.gameCreation).toISOString(),
        };
        // 4. Create match fragments for RAG (early/mid/late game analysis)
        const fragments = createMatchFragments(matchData, participant, stats);
        // 5. Store match stats in DynamoDB
        await dynamoClient.send(new lib_dynamodb_1.PutCommand({
            TableName: MATCHES_TABLE,
            Item: {
                ...stats,
                ttl: Math.floor(Date.now() / 1000) + 30 * 24 * 60 * 60, // 30 days
            },
        }));
        console.log('Stored match in DynamoDB', { matchId });
        // 6. Store fragments in processed bucket
        const fragmentsKey = `${region}/${puuid}/${matchId}-fragments.json`;
        await s3Client.send(new client_s3_1.PutObjectCommand({
            Bucket: PROCESSED_BUCKET,
            Key: fragmentsKey,
            Body: JSON.stringify(fragments),
            ContentType: 'application/json',
        }));
        console.log('Stored fragments in S3', { fragmentsKey });
        // 7. Trigger AI Lambda for insight generation (async)
        try {
            await lambdaClient.send(new client_lambda_1.InvokeCommand({
                FunctionName: 'rift-rewind-ai',
                InvocationType: 'Event', // Async invoke
                Payload: JSON.stringify({
                    puuid,
                    matchId,
                    region,
                    fragmentsKey,
                }),
            }));
            console.log('Triggered AI Lambda', { matchId });
        }
        catch (error) {
            console.warn('Failed to trigger AI Lambda (non-critical):', error);
        }
        console.log('Processing complete', { matchId });
    }
    catch (error) {
        console.error('Error in processing:', error);
        throw error;
    }
};
exports.handler = handler;
/**
 * Create match fragments for RAG analysis
 */
function createMatchFragments(matchData, participant, stats) {
    const duration = matchData.info.gameDuration;
    const earlyGame = duration >= 600; // 10 minutes
    const midGame = duration >= 1200; // 20 minutes
    const lateGame = duration >= 1800; // 30 minutes
    return {
        matchId: stats.matchId,
        puuid: stats.puuid,
        summary: `${participant.championName} ${stats.role} - ${stats.win ? 'Victory' : 'Defeat'} - ${stats.kills}/${stats.deaths}/${stats.assists} KDA`,
        performance: {
            kda: stats.kda,
            kills: stats.kills,
            deaths: stats.deaths,
            assists: stats.assists,
            csPerMin: stats.csPerMin,
            goldPerMin: stats.goldEarned / (duration / 60),
            damageShare: calculateDamageShare(matchData, participant),
            visionScore: stats.visionScore,
        },
        phases: {
            early: earlyGame ? `Early game (0-10min): CS advantage, lane pressure` : null,
            mid: midGame ? `Mid game (10-20min): Team fights, objective control` : null,
            late: lateGame ? `Late game (20+min): Scaling, positioning` : null,
        },
        keyMoments: extractKeyMoments(participant),
        itemBuild: participant.item0 ? [
            participant.item0,
            participant.item1,
            participant.item2,
            participant.item3,
            participant.item4,
            participant.item5,
        ].filter(Boolean) : [],
        timestamp: stats.timestamp,
    };
}
/**
 * Calculate player's damage share in the team
 */
function calculateDamageShare(matchData, participant) {
    const team = matchData.info.participants.filter((p) => p.teamId === participant.teamId);
    const totalTeamDamage = team.reduce((sum, p) => sum + p.totalDamageDealtToChampions, 0);
    return totalTeamDamage > 0
        ? (participant.totalDamageDealtToChampions / totalTeamDamage) * 100
        : 0;
}
/**
 * Extract key performance moments
 */
function extractKeyMoments(participant) {
    const moments = [];
    if (participant.firstBloodKill)
        moments.push('First Blood');
    if (participant.pentaKills > 0)
        moments.push(`${participant.pentaKills} Penta Kill${participant.pentaKills > 1 ? 's' : ''}`);
    if (participant.quadraKills > 0)
        moments.push(`${participant.quadraKills} Quadra Kill${participant.quadraKills > 1 ? 's' : ''}`);
    if (participant.tripleKills > 0)
        moments.push(`${participant.tripleKills} Triple Kill${participant.tripleKills > 1 ? 's' : ''}`);
    if (participant.killingSprees > 0)
        moments.push('Killing Spree');
    if (participant.largestMultiKill >= 2)
        moments.push(`${participant.largestMultiKill}x Multikill`);
    return moments;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxrREFBa0Y7QUFDbEYsOERBQTBEO0FBQzFELHdEQUEyRTtBQUMzRSwwREFBcUU7QUFFckUsTUFBTSxRQUFRLEdBQUcsSUFBSSxvQkFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ2xDLE1BQU0sWUFBWSxHQUFHLHFDQUFzQixDQUFDLElBQUksQ0FBQyxJQUFJLGdDQUFjLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUN6RSxNQUFNLFlBQVksR0FBRyxJQUFJLDRCQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7QUFFMUMsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFjLENBQUM7QUFDakQsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFXLENBQUM7QUFDM0MsTUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFpQixDQUFDO0FBRXZELG9EQUFvRDtBQUNwRCxTQUFTLFlBQVksQ0FBQyxLQUFhLEVBQUUsTUFBYyxFQUFFLE9BQWU7SUFDbEUsT0FBTyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsR0FBRyxNQUFNLENBQUM7QUFDckUsQ0FBQztBQUVELFNBQVMsaUJBQWlCLENBQUMsRUFBVSxFQUFFLGVBQXVCO0lBQzVELE9BQU8sQ0FBQyxFQUFFLEdBQUcsZUFBZSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ3JDLENBQUM7QUFRRDs7R0FFRztBQUNJLE1BQU0sT0FBTyxHQUFHLEtBQUssRUFBRSxLQUFzQixFQUFpQixFQUFFO0lBQ3JFLE9BQU8sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBRXBELE1BQU0s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UUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ2pFLElBQUksV0FBVyxDQUFDLGdCQUFnQixJQUFJLENBQUM7UUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsV0FBVyxDQUFDLGdCQUFnQixhQUFhLENBQUMsQ0FBQztJQUVsRyxPQUFPLE9BQU8sQ0FBQztBQUNqQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUzNDbGllbnQsIEdldE9iamVjdENvbW1hbmQsIFB1dE9iamVjdENvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xuaW1wb3J0IHsgRHluYW1vREJDbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtZHluYW1vZGInO1xuaW1wb3J0IHsgRHluYW1vREJEb2N1bWVudENsaWVudCwgUHV0Q29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2xpYi1keW5hbW9kYic7XG5pbXBvcnQgeyBMYW1iZGFDbGllbnQsIEludm9rZUNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtbGFtYmRhJztcblxuY29uc3QgczNDbGllbnQgPSBuZXcgUzNDbGllbnQoe30pO1xuY29uc3QgZHluYW1vQ2xpZW50ID0gRHluYW1vREJEb2N1bWVudENsaWVudC5mcm9tKG5ldyBEeW5hbW9EQkNsaWVudCh7fSkpO1xuY29uc3QgbGFtYmRhQ2xpZW50ID0gbmV3IExhbWJkYUNsaWVudCh7fSk7XG5cbmNvbnN0IE1BVENIRVNfVEFCTEUgPSBwcm9jZXNzLmVudi5NQVRDSEVTX1RBQkxFITtcbmNvbnN0IFJBV19CVUNLRVQgPSBwcm9jZXNzLmVudi5SQVdfQlVDS0VUITtcbmNvbnN0IFBST0NFU1NFRF9CVUNLRVQgPSBwcm9jZXNzLmVudi5QUk9DRVNTRURfQlVDS0VUITtcblxuLy8gVXRpbGl0eSBmdW5jdGlvbnMgKGlubGluZSB0byBhdm9pZCBpbXBvcnQgaXNzdWVzKVxuZnVuY3Rpb24gY2FsY3VsYXRlS0RBKGtpbGxzOiBudW1iZXIsIGRlYXRoczogbnVtYmVyLCBhc3Npc3RzOiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gZGVhdGhzID09PSAwID8ga2lsbHMgKyBhc3Npc3RzIDogKGtpbGxzICsgYXNzaXN0cykgLyBkZWF0aHM7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZUNTUGVyTWluKGNzOiBudW1iZXIsIGR1cmF0aW9uU2Vjb25kczogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIChjcyAvIGR1cmF0aW9uU2Vjb25kcykgKiA2MDtcbn1cblxuaW50ZXJmYWNlIFByb2Nlc3NpbmdFdmVudCB7XG4gIHB1dWlkOiBzdHJpbmc7XG4gIG1hdGNoSWQ6IHN0cmluZztcbiAgcmVnaW9uOiBzdHJpbmc7XG59XG5cbi8qKlxuICogUHJvY2Vzc2luZyBMYW1iZGEgLSBDb21wdXRlIHN0YXRzIGFuZCBjcmVhdGUgbWF0Y2ggZnJhZ21lbnRzXG4gKi9cbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gYXN5bmMgKGV2ZW50OiBQcm9jZXNzaW5nRXZlbnQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgY29uc29sZS5sb2coJ1Byb2Nlc3NpbmcgTGFtYmRhIGludm9rZWQnLCB7IGV2ZW50IH0pO1xuXG4gIGNvbnN0IHsgcHV1aWQsIG1hdGNoSWQsIHJlZ2lvbiB9ID0gZXZlbnQ7XG5cbiAgdHJ5IHtcbiAgICAvLyAxLiBSZWFkIHJhdyBtYXRjaCBkYXRhIGZyb20gUzNcbiAgICBjb25zdCBzM0tleSA9IGAke3JlZ2lvbn0vJHtwdXVpZH0vJHttYXRjaElkfS5qc29uYDtcbiAgICBjb25zdCBnZXRDb21tYW5kID0gbmV3IEdldE9iamVjdENvbW1hbmQoe1xuICAgICAgQnVja2V0OiBSQVdfQlVDS0VULFxuICAgICAgS2V5OiBzM0tleSxcbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHMzQ2xpZW50LnNlbmQoZ2V0Q29tbWFuZCk7XG4gICAgY29uc3QgbWF0Y2hEYXRhID0gSlNPTi5wYXJzZShhd2FpdCByZXNwb25zZS5Cb2R5IS50cmFuc2Zvcm1Ub1N0cmluZygpKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnUmV0cmlldmVkIG1hdGNoIGRhdGEnLCB7IG1hdGNoSWQgfSk7XG5cbiAgICAvLyAyLiBGaW5kIHBsYXllcidzIHBhcnRpY2lwYW50IGRhdGFcbiAgICBjb25zdCBwYXJ0aWNpcGFudCA9IG1hdGNoRGF0YS5pbmZvLnBhcnRpY2lwYW50cy5maW5kKFxuICAgICAgKHA6IGFueSkgPT4gcC5wdXVpZCA9PT0gcHV1aWRcbiAgICApO1xuICAgIFxuICAgIGlmICghcGFydGljaXBhbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUGxheWVyICR7cHV1aWR9IG5vdCBmb3VuZCBpbiBtYXRjaCAke21hdGNoSWR9YCk7XG4gICAgfVxuXG4gICAgLy8gMy4gQ29tcHV0ZSBzdGF0aXN0aWNzXG4gICAgY29uc3Qgc3RhdHMgPSB7XG4gICAgICBtYXRjaElkLFxuICAgICAgcHV1aWQsXG4gICAgICBjaGFtcGlvbk5hbWU6IHBhcnRpY2lwYW50LmNoYW1waW9uTmFtZSxcbiAgICAgIGNoYW1waW9uSWQ6IHBhcnRpY2lwYW50LmNoYW1waW9uSWQsXG4gICAgICByb2xlOiBwYXJ0aWNpcGFudC50ZWFtUG9zaXRpb24gfHwgcGFydGljaXBhbnQuaW5kaXZpZHVhbFBvc2l0aW9uLFxuICAgICAga2lsbHM6IHBhcnRpY2lwYW50LmtpbGxzLFxuICAgICAgZGVhdGhzOiBwYXJ0aWNpcGFudC5kZWF0aHMsXG4gICAgICBhc3Npc3RzOiBwYXJ0aWNpcGFudC5hc3Npc3RzLFxuICAgICAga2RhOiBjYWxjdWxhdGVLREEocGFydGljaXBhbnQua2lsbHMsIHBhcnRpY2lwYW50LmRlYXRocywgcGFydGljaXBhbnQuYXNzaXN0cyksXG4gICAgICB0b3RhbENTOiBwYXJ0aWNpcGFudC50b3RhbE1pbmlvbnNLaWxsZWQgKyBwYXJ0aWNpcGFudC5uZXV0cmFsTWluaW9uc0tpbGxlZCxcbiAgICAgIGNzUGVyTWluOiBjYWxjdWxhdGVDU1Blck1pbihcbiAgICAgICAgcGFydGljaXBhbnQudG90YWxNaW5pb25zS2lsbGVkICsgcGFydGljaXBhbnQubmV1dHJhbE1pbmlvbnNLaWxsZWQsXG4gICAgICAgIG1hdGNoRGF0YS5pbmZvLmdhbWVEdXJhdGlvblxuICAgICAgKSxcbiAgICAgIGdvbGRFYXJuZWQ6IHBhcnRpY2lwYW50LmdvbGRFYXJuZWQsXG4gICAgICBkYW1hZ2VEZWFsdDogcGFydGljaXBhbnQudG90YWxEYW1hZ2VEZWFsdFRvQ2hhbXBpb25zLFxuICAgICAgZGFtYWdlVGFrZW46IHBhcnRpY2lwYW50LnRvdGFsRGFtYWdlVGFrZW4sXG4gICAgICB2aXNpb25TY29yZTogcGFydGljaXBhbnQudmlzaW9uU2NvcmUsXG4gICAgICB3aW46IHBhcnRpY2lwYW50LndpbixcbiAgICAgIGdhbWVEdXJhdGlvbjogbWF0Y2hEYXRhLmluZm8uZ2FtZUR1cmF0aW9uLFxuICAgICAgZ2FtZU1vZGU6IG1hdGNoRGF0YS5pbmZvLmdhbWVNb2RlLFxuICAgICAgcXVldWVJZDogbWF0Y2hEYXRhLmluZm8ucXVldWVJZCxcbiAgICAgIGdhbWVDcmVhdGlvbjogbWF0Y2hEYXRhLmluZm8uZ2FtZUNyZWF0aW9uLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZShtYXRjaERhdGEuaW5mby5nYW1lQ3JlYXRpb24pLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcblxuICAgIC8vIDQuIENyZWF0ZSBtYXRjaCBmcmFnbWVudHMgZm9yIFJBRyAoZWFybHkvbWlkL2xhdGUgZ2FtZSBhbmFseXNpcylcbiAgICBjb25zdCBmcmFnbWVudHMgPSBjcmVhdGVNYXRjaEZyYWdtZW50cyhtYXRjaERhdGEsIHBhcnRpY2lwYW50LCBzdGF0cyk7XG4gICAgXG4gICAgLy8gNS4gU3RvcmUgbWF0Y2ggc3RhdHMgaW4gRHluYW1vREJcbiAgICBhd2FpdCBkeW5hbW9DbGllbnQuc2VuZChcbiAgICAgIG5ldyBQdXRDb21tYW5kKHtcbiAgICAgICAgVGFibGVOYW1lOiBNQVRDSEVTX1RBQkxFLFxuICAgICAgICBJdGVtOiB7XG4gICAgICAgICAgLi4uc3RhdHMsXG4gICAgICAgICAgdHRsOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDMwICogMjQgKiA2MCAqIDYwLCAvLyAzMCBkYXlzXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ1N0b3JlZCBtYXRjaCBpbiBEeW5hbW9EQicsIHsgbWF0Y2hJZCB9KTtcblxuICAgIC8vIDYuIFN0b3JlIGZyYWdtZW50cyBpbiBwcm9jZXNzZWQgYnVja2V0XG4gICAgY29uc3QgZnJhZ21lbnRzS2V5ID0gYCR7cmVnaW9ufS8ke3B1dWlkfS8ke21hdGNoSWR9LWZyYWdtZW50cy5qc29uYDtcbiAgICBhd2FpdCBzM0NsaWVudC5zZW5kKFxuICAgICAgbmV3IFB1dE9iamVjdENvbW1hbmQoe1xuICAgICAgICBCdWNrZXQ6IFBST0NFU1NFRF9CVUNLRVQsXG4gICAgICAgIEtleTogZnJhZ21lbnRzS2V5LFxuICAgICAgICBCb2R5OiBKU09OLnN0cmluZ2lmeShmcmFnbWVudHMpLFxuICAgICAgICBDb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgfSlcbiAgICApO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdTdG9yZWQgZnJhZ21lbnRzIGluIFMzJywgeyBmcmFnbWVudHNLZXkgfSk7XG5cbiAgICAvLyA3LiBUcmlnZ2VyIEFJIExhbWJkYSBmb3IgaW5zaWdodCBnZW5lcmF0aW9uIChhc3luYylcbiAgICB0cnkge1xuICAgICAgYXdhaXQgbGFtYmRhQ2xpZW50LnNlbmQoXG4gICAgICAgIG5ldyBJbnZva2VDb21tYW5kKHtcbiAgICAgICAgICBGdW5jdGlvbk5hbWU6ICdyaWZ0LXJld2luZC1haScsXG4gICAgICAgICAgSW52b2NhdGlvblR5cGU6ICdFdmVudCcsIC8vIEFzeW5jIGludm9rZVxuICAgICAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIHB1dWlkLFxuICAgICAgICAgICAgbWF0Y2hJZCxcbiAgICAgICAgICAgIHJlZ2lvbixcbiAgICAgICAgICAgIGZyYWdtZW50c0tleSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBjb25zb2xlLmxvZygnVHJpZ2dlcmVkIEFJIExhbWJkYScsIHsgbWF0Y2hJZCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gdHJpZ2dlciBBSSBMYW1iZGEgKG5vbi1jcml0aWNhbCk6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdQcm9jZXNzaW5nIGNvbXBsZXRlJywgeyBtYXRjaElkIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHByb2Nlc3Npbmc6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSBtYXRjaCBmcmFnbWVudHMgZm9yIFJBRyBhbmFseXNpc1xuICovXG5mdW5jdGlvbiBjcmVhdGVNYXRjaEZyYWdtZW50cyhtYXRjaERhdGE6IGFueSwgcGFydGljaXBhbnQ6IGFueSwgc3RhdHM6IGFueSkge1xuICBjb25zdCBkdXJhdGlvbiA9IG1hdGNoRGF0YS5pbmZvLmdhbWVEdXJhdGlvbjtcbiAgY29uc3QgZWFybHlHYW1lID0gZHVyYXRpb24gPj0gNjAwOyAvLyAxMCBtaW51dGVzXG4gIGNvbnN0IG1pZEdhbWUgPSBkdXJhdGlvbiA+PSAxMjAwOyAvLyAyMCBtaW51dGVzXG4gIGNvbnN0IGxhdGVHYW1lID0gZHVyYXRpb24gPj0gMTgwMDsgLy8gMzAgbWludXRlc1xuXG4gIHJldHVybiB7XG4gICAgbWF0Y2hJZDogc3RhdHMubWF0Y2hJZCxcbiAgICBwdXVpZDogc3RhdHMucHV1aWQsXG4gICAgc3VtbWFyeTogYCR7cGFydGljaXBhbnQuY2hhbXBpb25OYW1lfSAke3N0YXRzLnJvbGV9IC0gJHtzdGF0cy53aW4gPyAnVmljdG9yeScgOiAnRGVmZWF0J30gLSAke3N0YXRzLmtpbGxzfS8ke3N0YXRzLmRlYXRoc30vJHtzdGF0cy5hc3Npc3RzfSBLREFgLFxuICAgIFxuICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICBrZGE6IHN0YXRzLmtkYSxcbiAgICAgIGtpbGxzOiBzdGF0cy5raWxscyxcbiAgICAgIGRlYXRoczogc3RhdHMuZGVhdGhzLFxuICAgICAgYXNzaXN0czogc3RhdHMuYXNzaXN0cyxcbiAgICAgIGNzUGVyTWluOiBzdGF0cy5jc1Blck1pbixcbiAgICAgIGdvbGRQZXJNaW46IHN0YXRzLmdvbGRFYXJuZWQgLyAoZHVyYXRpb24gLyA2MCksXG4gICAgICBkYW1hZ2VTaGFyZTogY2FsY3VsYXRlRGFtYWdlU2hhcmUobWF0Y2hEYXRhLCBwYXJ0aWNpcGFudCksXG4gICAgICB2aXNpb25TY29yZTogc3RhdHMudmlzaW9uU2NvcmUsXG4gICAgfSxcbiAgICBcbiAgICBwaGFzZXM6IHtcbiAgICAgIGVhcmx5OiBlYXJseUdhbWUgPyBgRWFybHkgZ2FtZSAoMC0xMG1pbik6IENTIGFkdmFudGFnZSwgbGFuZSBwcmVzc3VyZWAgOiBudWxsLFxuICAgICAgbWlkOiBtaWRHYW1lID8gYE1pZCBnYW1lICgxMC0yMG1pbik6IFRlYW0gZmlnaHRzLCBvYmplY3RpdmUgY29udHJvbGAgOiBudWxsLFxuICAgICAgbGF0ZTogbGF0ZUdhbWUgPyBgTGF0ZSBnYW1lICgyMCttaW4pOiBTY2FsaW5nLCBwb3NpdGlvbmluZ2AgOiBudWxsLFxuICAgIH0sXG4gICAgXG4gICAga2V5TW9tZW50czogZXh0cmFjdEtleU1vbWVudHMocGFydGljaXBhbnQpLFxuICAgIFxuICAgIGl0ZW1CdWlsZDogcGFydGljaXBhbnQuaXRlbTAgPyBbXG4gICAgICBwYXJ0aWNpcGFudC5pdGVtMCxcbiAgICAgIHBhcnRpY2lwYW50Lml0ZW0xLFxuICAgICAgcGFydGljaXBhbnQuaXRlbTIsXG4gICAgICBwYXJ0aWNpcGFudC5pdGVtMyxcbiAgICAgIHBhcnRpY2lwYW50Lml0ZW00LFxuICAgICAgcGFydGljaXBhbnQuaXRlbTUsXG4gICAgXS5maWx0ZXIoQm9vbGVhbikgOiBbXSxcbiAgICBcbiAgICB0aW1lc3RhbXA6IHN0YXRzLnRpbWVzdGFtcCxcbiAgfTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgcGxheWVyJ3MgZGFtYWdlIHNoYXJlIGluIHRoZSB0ZWFtXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZURhbWFnZVNoYXJlKG1hdGNoRGF0YTogYW55LCBwYXJ0aWNpcGFudDogYW55KTogbnVtYmVyIHtcbiAgY29uc3QgdGVhbSA9IG1hdGNoRGF0YS5pbmZvLnBhcnRpY2lwYW50cy5maWx0ZXIoXG4gICAgKHA6IGFueSkgPT4gcC50ZWFtSWQgPT09IHBhcnRpY2lwYW50LnRlYW1JZFxuICApO1xuICBjb25zdCB0b3RhbFRlYW1EYW1hZ2UgPSB0ZWFtLnJlZHVjZShcbiAgICAoc3VtOiBudW1iZXIsIHA6IGFueSkgPT4gc3VtICsgcC50b3RhbERhbWFnZURlYWx0VG9DaGFtcGlvbnMsXG4gICAgMFxuICApO1xuICByZXR1cm4gdG90YWxUZWFtRGFtYWdlID4gMFxuICAgID8gKHBhcnRpY2lwYW50LnRvdGFsRGFtYWdlRGVhbHRUb0NoYW1waW9ucyAvIHRvdGFsVGVhbURhbWFnZSkgKiAxMDBcbiAgICA6IDA7XG59XG5cbi8qKlxuICogRXh0cmFjdCBrZXkgcGVyZm9ybWFuY2UgbW9tZW50c1xuICovXG5mdW5jdGlvbiBleHRyYWN0S2V5TW9tZW50cyhwYXJ0aWNpcGFudDogYW55KSB7XG4gIGNvbnN0IG1vbWVudHMgPSBbXTtcbiAgXG4gIGlmIChwYXJ0aWNpcGFudC5maXJzdEJsb29kS2lsbCkgbW9tZW50cy5wdXNoKCdGaXJzdCBCbG9vZCcpO1xuICBpZiAocGFydGljaXBhbnQucGVudGFLaWxscyA+IDApIG1vbWVudHMucHVzaChgJHtwYXJ0aWNpcGFudC5wZW50YUtpbGxzfSBQZW50YSBLaWxsJHtwYXJ0aWNpcGFudC5wZW50YUtpbGxzID4gMSA/ICdzJyA6ICcnfWApO1xuICBpZiAocGFydGljaXBhbnQucXVhZHJhS2lsbHMgPiAwKSBtb21lbnRzLnB1c2goYCR7cGFydGljaXBhbnQucXVhZHJhS2lsbHN9IFF1YWRyYSBLaWxsJHtwYXJ0aWNpcGFudC5xdWFkcmFLaWxscyA+IDEgPyAncycgOiAnJ31gKTtcbiAgaWYgKHBhcnRpY2lwYW50LnRyaXBsZUtpbGxzID4gMCkgbW9tZW50cy5wdXNoKGAke3BhcnRpY2lwYW50LnRyaXBsZUtpbGxzfSBUcmlwbGUgS2lsbCR7cGFydGljaXBhbnQudHJpcGxlS2lsbHMgPiAxID8gJ3MnIDogJyd9YCk7XG4gIGlmIChwYXJ0aWNpcGFudC5raWxsaW5nU3ByZWVzID4gMCkgbW9tZW50cy5wdXNoKCdLaWxsaW5nIFNwcmVlJyk7XG4gIGlmIChwYXJ0aWNpcGFudC5sYXJnZXN0TXVsdGlLaWxsID49IDIpIG1vbWVudHMucHVzaChgJHtwYXJ0aWNpcGFudC5sYXJnZXN0TXVsdGlLaWxsfXggTXVsdGlraWxsYCk7XG4gIFxuICByZXR1cm4gbW9tZW50cztcbn1cbiJdfQ==